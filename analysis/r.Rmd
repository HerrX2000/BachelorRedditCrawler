---
title: "RedditAnalysis"
author: "Frederik Mann"
date: "29 6 2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r }
library(pacman)
p_load(RColorBrewer, # color pallets
       ggplot2, # reportable graphs
       cowplot, # arranges ggplot graphs nicely
       stargazer,
       MASS,
       DescTools) 
```

### Import data set
```{r}
df <- read.csv("posts_berlin_2020.csv")
```

### Inspect
```{r}
str(df)

df$over_18 <- as.logical(df$over_18)
df$locked <- as.logical(df$locked)
df$is_video <- as.logical(df$is_video)
df$is_original_content <- as.logical(df$is_original_content)
df$stickied <- as.logical(df$stickied)

dim(df)
```

### Preprocess: Treat missing values, if applicable
```{r}
df[df == "NULL"] <- NA
nrow(df)
df <- unique(df, by = "id")
nrow(df)

# Track down variables with missing values
sum(is.na(df))
colSums(is.na(df))

# Check the percentage of missing values in the data set
(nrow(df) - nrow(na.omit(df))) / nrow(df)


df$date <- as.Date(df$datetime)



to_interval <- function(anchor.date, future.date, interval.days){
  round(as.integer(future.date - anchor.date) / interval.days, 0)
}

df$week_interval <- to_interval(as.Date('2020-01-01'), 
                          df$date, 7 )

df$month <- format(df$date, "%m")
df$month <- factor(df$month)

df <- df[!(df$stickied == TRUE),]

str(df)

```

```{r}
data.frame(table(df$month))

dfwi <- data.frame(table(df$week_interval))
dfwi

ggplot(df, aes(factor(week_interval),fill = df$class)) +
geom_bar(stat="count", position = "dodge") + 
scale_fill_brewer(palette = "Set1")

Gini(dfwi$Freq)

nrow(df)
df_with_acc <- na.omit(df)
nrow(df_with_acc)

df_with_acc <- df_with_acc[df_with_acc$score > 10,]

gini_by_months <- data.frame(
                 month=character(),
                 gini=double(), 
                 stringsAsFactors=TRUE
                 ) 
  
for (month in unique(df_with_acc$month)){
  mnth_df <- df_with_acc[df_with_acc$month == month, ]
  agg <- aggregate(mnth_df$score, by=list(author=mnth_df$author), FUN=sum)
  gini <- Gini(agg$x)
  gini_by_month <- data.frame(
                 month=month,
                 gini=gini, 
                 stringsAsFactors=TRUE
                 )
  gini_by_months <- rbind(gini_by_months, gini_by_month)
}


ggplot(gini_by_months, aes(x=month, y=gini)) + geom_point()

agg <- aggregate(df_with_acc$score, by=list(author=df_with_acc$author), FUN=sum)
#agg
Gini(agg$x)

ggplot(agg, aes(x=author, y=x)) + geom_point()

```

